import { IRequest, IResponse } from '../classes/interfaces';
import {  withErrorHandler } from '../utils/utils';
import { BaseRouter } from './baseRouter';
import { Report } from '../models/report/report';
import { CityManager } from '../manager/cityManager';
import { TourManager } from '../manager/tourManager';
import * as fs from 'fs';
import { POI } from '../models/tours/poiModel';
import { POIManager } from '../manager/poiManager';
const axios = require('axios');
const { createInvoice } = require("../classes/createInvoice");

import * as sgMail from '@sendgrid/mail';

function sleep(ms) {
	return new Promise((resolve) => {
	  setTimeout(resolve, ms);
	});
  }
interface helpObjectSort {
	from: string;
	count: number;
};


sgMail.setApiKey("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")
var emailSender = "beta-app@gogiro.app";


export class CityRouter extends BaseRouter {
	cityManager: CityManager;

	constructor() {
		super(true);
		this.cityManager = new CityManager();
		this.init();
	}

	init(): void {
		/** GET report for one company/point  */
		this.router.get(
			'/:city',
			//allowFor([AdminRole, SupportRole, ServiceRole]),
			withErrorHandler(async (req: IRequest, res: IResponse) => {
				try{
			var resp = []

			await axios.get("https://api.amadeus-discover.com/api/consumer/products?search=city%3A"+req.params.city+"&resultsPerPage=100&pageNumber=1&sortingOrder=asc", {
					headers: {
						'Authorization': 'Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJWZk0xTzR3aDJieEJPTnM1TGRKVHFwQ3pfTVdsOHBRQlRqb3VUek5ibjZZIn0.eyJleHAiOjE2OTU4OTMxODMsImlhdCI6MTY5NTg5MjI4MywianRpIjoiMjQ4OWYxYjgtNjAyOS00OWExLTkyNzItNzFkZmYzMzU0ZGM3IiwiaXNzIjoiaHR0cHM6Ly9hcGkuYW1hZGV1cy1kaXNjb3Zlci5jb20vYXV0aC9yZWFsbXMvYW1hZGV1cy1kaXNjb3ZlciIsImF1ZCI6ImFjY291bnQiLCJzdWIiOiI5MDE0ZGUxZS1lMTNjLTQwOWQtOWQ3MS1hZmU1M2E3NTA5MGYiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJjb25zdW1lci1hcGkiLCJzZXNzaW9uX3N0YXRlIjoiYzUwOWNhZjUtMDY5Ni00MGM4LTg1N2ItZmNiZDhlYWQ2OGE5IiwiYWxsb3dlZC1vcmlnaW5zIjpbIioiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYW1hZGV1cy1kaXNjb3ZlciIsIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJjb25zdW1lci1hcGkiOnsicm9sZXMiOlsiREVGQVVMVF9VU0VSIiwiT1JHQU5JWkFUSU9OX0FETUlOIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6InByb2ZpbGUgZW1haWwiLCJzaWQiOiJjNTA5Y2FmNS0wNjk2LTQwYzgtODU3Yi1mY2JkOGVhZDY4YTkiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwicGVybWlzc2lvbnMiOnsiTkFNRVNQQUNFIjpbIk5BTUVTUEFDRSJdLCJDUkVBVEVfTkVXX0FDQ09VTlQiOlsiTkFNRVNQQUNFIl0sIlJFVFJJRVZFX09SR0FOSVpBVElPTl9JTkZPUk1BVElPTiI6WyJOQU1FU1BBQ0UiXSwiQ09OU1VNRVJfQVBJLURFTEVURV9TVUdHRVNUSU9OIjpbIk5BTUVTUEFDRSJdLCJDT05TVU1FUl9BUEktVVBEQVRFX0NIQU5ORUwiOlsiTkFNRVNQQUNFIl0sIlVQREFURV9BQ0NPVU5UIjpbIk5BTUVTUEFDRSJdLCJDT05TVU1FUl9BUEktR0VUX0JPT0tJTkdTIjpbIk5BTUVTUEFDRSJdLCJDT05TVU1FUl9BUEktUkVUUklFVkVfU1VHR0VTVElPTl9JTkZPUk1BVElPTiI6WyJOQU1FU1BBQ0UiXSwiQ09OU1VNRVJfQVBJLVJFVFJJRVZFX0FMTF9USEVfU0hBUklOR19DSEFOTkVMU19CWV9PUkdBTklaQVRJT05fSUQiOlsiTkFNRVNQQUNFIl0sIkRFTEVURV9TVUdHRVNUSU9OX1NFVCI6WyJOQU1FU1BBQ0UiXSwiU0VBUkNIX1NVR0dFU1RJT05TIjpbIk5BTUVTUEFDRSJdLCJVUERBVEVfU1VHR0VTVElPTiI6WyJOQU1FU1BBQ0UiXSwiQ09OU1VNRVJfQVBJLVJFVFJJRVZFX0NIQU5ORUxfSU5GT1JNQVRJT04iOlsiTkFNRVNQQUNFIl0sIkNPTlNVTUVSX0FQSS1SRVRSSUVWRV9TVUdHRVNUSU9OX1NFVF9JTkZPUk1BVElPTiI6WyJOQU1FU1BBQ0UiXSwiQ09OU1VNRVJfQVBJLVJFVFJJRVZFX0FDQ09VTlRfSU5GT1JNQVRJT04iOlsiTkFNRVNQQUNFIl0sIkNPTlNVTUVSX0FQSS1BQ0NFU1NfQUxFWF9BUFAiOlsiTkFNRVNQQUNFIl0sIkNPTlNVTUVSX0FQSS1TRUFSQ0hfUFJPRFVDVF9JTkZPUk1BVElPTiI6WyJOQU1FU1BBQ0UiXSwiQ1JFQVRFX05FV19DSEFOTkVMIjpbIk5BTUVTUEFDRSJdLCJVUERBVEVfQ0hBTk5FTCI6WyJOQU1FU1BBQ0UiXSwiR0VUX0JPT0tJTkdfREVUQUlMUyI6WyJOQU1FU1BBQ0UiXSwiUkVUUklFVkVfU1VHR0VTVElPTl9JTkZPUk1BVElPTiI6WyJOQU1FU1BBQ0UiXSwiQ1JFQVRFX05FV19PUkdBTklaQVRJT04iOlsiTkFNRVNQQUNFIl0sIkNPTlNVTUVSX0FQSS1BRERfU1VHR0VTVElPTl9UT19TVUdHRVNUSU9OX1NFVCI6WyJOQU1FU1BBQ0UiXSwiQ09OU1VNRVJfQVBJLUNSRUFURV9ORVdfU1VHR0VTVElPTiI6WyJOQU1FU1BBQ0UiXSwiQ09OU1VNRVJfQVBJLVVQREFURV9TVUdHRVNUSU9OIjpbIk5BTUVTUEFDRSJdLCJHRVRfQk9PS0lOR1MiOlsiTkFNRVNQQUNFIl0sIkNPTlNVTUVSX0FQSS1ERUxFVEVfU1VHR0VTVElPTl9TRVQiOlsiTkFNRVNQQUNFIl0sIkFDQ0VTU19SRUdJU1RSQVRJT04iOlsiTkFNRVNQQUNFIl0sIkNPTlNVTUVSX0FQSS1TRUFSQ0hfU1VHR0VTVElPTl9TRVRTIjpbIk5BTUVTUEFDRSJdLCJTRUFSQ0hfU1VQUExJRVJfSU5GT1JNQVRJT04iOlsiTkFNRVNQQUNFIl0sIlJFVFJJRVZFX0NPTlNVTUVSX1BST0RVQ1RfSU5GT1JNQVRJT04iOlsiTkFNRVNQQUNFIl0sIlVQREFURV9TVUdHRVNUSU9OX1NFVCI6WyJOQU1FU1BBQ0UiXSwiQ09OU1VNRVJfQVBJLUNSRUFURV9ORVdfU1VHR0VTVElPTl9TRVQiOlsiTkFNRVNQQUNFIl0sIkNPTlNVTUVSX0FQSS1VUERBVEVfT1JHQU5JWkFUSU9OIjpbIk5BTUVTUEFDRSJdLCJDT05TVU1FUl9BUEktQUREX1BST0RVQ1RfVE9fU1VHR0VTVElPTiI6WyJOQU1FU1BBQ0UiXSwiQ09OU1VNRVJfQVBJLVNFQVJDSF9TVVBQTElFUl9JTkZPUk1BVElPTiI6WyJOQU1FU1BBQ0UiXSwiQ09OU1VNRVJfQVBJLUFDQ0VTU19SRUdJU1RSQVRJT04iOlsiTkFNRVNQQUNFIl0sIkNPTlNVTUVSX0FQSS1ERUxFVEVfU1VHR0VTVElPTl9GUk9NX1NVR0dFU1RJT05fU0VUIjpbIk5BTUVTUEFDRSJdLCJSRVRSSUVWRV9DSEFOTkVMX0lORk9STUFUSU9OIjpbIk5BTUVTUEFDRSJdLCJDT05TVU1FUl9BUEktUkVUUklFVkVfQ09OU1VNRVJfUFJPRFVDVF9JTkZPUk1BVElPTiI6WyJOQU1FU1BBQ0UiXSwiQUNDRVNTX0FMRVhfQVBQIjpbIk5BTUVTUEFDRSJdLCJTRUFSQ0hfU1VHR0VTVElPTl9TRVRTIjpbIk5BTUVTUEFDRSJdLCJDT05TVU1FUl9BUEktQ1JFQVRFX05FV19BQ0NPVU5UIjpbIk5BTUVTUEFDRSJdLCJBRERfU1VHR0VTVElPTl9UT19TVUdHRVNUSU9OX1NFVCI6WyJOQU1FU1BBQ0UiXSwiUkVUUklFVkVfQUxMX1RIRV9TSEFSSU5HX0NIQU5ORUxTX0JZX09SR0FOSVpBVElPTl9JRCI6WyJOQU1FU1BBQ0UiXSwiQ09OU1VNRVJfQVBJLU5BTUVTUEFDRSI6WyJOQU1FU1BBQ0UiXSwiUkVUUklFVkVfQ09OU1VNRVJfU1VQUExJRVJfUFJPRFVDVFNfSU5GT1JNQVRJT04iOlsiTkFNRVNQQUNFIl0sIlJFVFJJRVZFX0FDQ09VTlRfSU5GT1JNQVRJT04iOlsiTkFNRVNQQUNFIl0sIkFERF9QUk9EVUNUX1RPX1NVR0dFU1RJT04iOlsiTkFNRVNQQUNFIl0sIkNPTlNVTUVSX0FQSS1SRVRSSUVWRV9DT05TVU1FUl9TVVBQTElFUl9QUk9EVUNUU19JTkZPUk1BVElPTiI6WyJOQU1FU1BBQ0UiXSwiQ09OU1VNRVJfQVBJLVNFQVJDSF9TVUdHRVNUSU9OUyI6WyJOQU1FU1BBQ0UiXSwiQ09OU1VNRVJfQVBJLVJFVFJJRVZFX0NPTlNVTUVSX1NVUFBMSUVSX0lORk9STUFUSU9OIjpbIk5BTUVTUEFDRSJdLCJDT05TVU1FUl9BUEktQ1JFQVRFX05FV19DSEFOTkVMIjpbIk5BTUVTUEFDRSJdLCJDT05TVU1FUl9BUEktREVMRVRFX1BST0RVQ1RfRlJPTV9TVUdHRVNUSU9OIjpbIk5BTUVTUEFDRSJdLCJERUxFVEVfUFJPRFVDVF9GUk9NX1NVR0dFU1RJT04iOlsiTkFNRVNQQUNFIl0sIkNPTlNVTUVSX0FQSS1SRVRSSUVWRV9PUkdBTklaQVRJT05fSU5GT1JNQVRJT04iOlsiTkFNRVNQQUNFIl0sIkNPTlNVTUVSX0FQSS1VUERBVEVfQUNDT1VOVCI6WyJOQU1FU1BBQ0UiXSwiUkVUUklFVkVfU1VHR0VTVElPTl9TRVRfSU5GT1JNQVRJT04iOlsiTkFNRVNQQUNFIl0sIkNPTlNVTUVSX0FQSS1SRVRSSUVWRV9CT09LSU5HX0VOR0lORV9JTkZPUk1BVElPTiI6WyJOQU1FU1BBQ0UiXSwiQ1JFQVRFX05FV19TVUdHRVNUSU9OX1NFVCI6WyJOQU1FU1BBQ0UiXSwiQ09OU1VNRVJfQVBJLUNSRUFURV9ORVdfT1JHQU5JWkFUSU9OIjpbIk5BTUVTUEFDRSJdLCJSRVRSSUVWRV9DT05TVU1FUl9TVVBQTElFUl9JTkZPUk1BVElPTiI6WyJOQU1FU1BBQ0UiXSwiQ09OU1VNRVJfQVBJLVVQREFURV9TVUdHRVNUSU9OX1NFVCI6WyJOQU1FU1BBQ0UiXSwiU0VBUkNIX1BST0RVQ1RfSU5GT1JNQVRJT04iOlsiTkFNRVNQQUNFIl0sIlJFVFJJRVZFX0JPT0tJTkdfRU5HSU5FX0lORk9STUFUSU9OIjpbIk5BTUVTUEFDRSJdLCJVUERBVEVfT1JHQU5JWkFUSU9OIjpbIk5BTUVTUEFDRSJdLCJERUxFVEVfU1VHR0VTVElPTl9GUk9NX1NVR0dFU1RJT05fU0VUIjpbIk5BTUVTUEFDRSJdLCJDUkVBVEVfTkVXX1NVR0dFU1RJT04iOlsiTkFNRVNQQUNFIl0sIkNPTlNVTUVSX0FQSS1HRVRfQk9PS0lOR19ERVRBSUxTIjpbIk5BTUVTUEFDRSJdLCJERUxFVEVfU1VHR0VTVElPTiI6WyJOQU1FU1BBQ0UiXX0sIm5hbWUiOiJLbGVtZW4gRnVybGFuIiwicHJlZmVycmVkX3VzZXJuYW1lIjoia2xlbWVuZnVybGFuIiwiZ2l2ZW5fbmFtZSI6IktsZW1lbiIsImZhbWlseV9uYW1lIjoiRnVybGFuIiwiZW1haWwiOiJrbGVtZW4uZnVybGFuQGdvZ2lyby5hcHAifQ.a1VRP4CtrlUxuQYILv_fUNgqb13Hd-kS_jTOljua54IM4St3_mC92HWWy3t2fYlRuMbE612ONVeolO1cptAOc3hnwjafNDBvZKYe6rxNNDqo1yH7RVmcaYV8in1cboSN_oa8QvbyjD-lxfxsVxR7ANVYlTgwx3oRrIWY_KBKp4qQ2DD_mJspR9kaHX5_Q45En2HW3ERi9zRwgUSntsfkfsemRZQqA5fdEnTECXwGddVSlcsWjDU4Jla9A0R4VYNt7tOLAxJSP5vW4DuzMysl-RBrvsc-8oJq6W4uFCRsRBee0YCf_PfIZTpsWEaTu84VuLaTNMqizDhv96Bac66HRg',
   						//'Content-Type': 'application/json'
					}
				})
					.then(async response => {
						console.log(response.data.items)
						
						res.status(200).send(response.data.items);



					})
					.catch(error => {

						console.log("error " + error)
						return res.status(402).send({ message: "You do not have enough tokens in d-id" });
					});


				//return res.status(200).send(response)
				}catch(err){
					return res.status(412).send(err)
				}
			})
		);
	
	}
}